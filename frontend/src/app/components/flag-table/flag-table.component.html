<div class="container">
  <p-toast></p-toast>
  
  <!-- Show loading spinner when in submitting state -->
  <div *ngIf="submitting" class="loading-container">
    <p-progressSpinner></p-progressSpinner>
    <p>Processing evaluation...</p>
  </div>
  
  <!-- Show evaluation results only when not loading and results exist -->
  <div *ngIf="!submitting && evaluationResult">
    <p-card header="Flagged Items" styleClass="p-mt-4">
      <!-- Red Flags Section -->
      <div *ngIf="redFlags.length > 0" class="p-mb-4">
        <h3>Red Flags</h3>
        <div *ngFor="let category of getFlagsByCategoryForDisplay(redFlags)">
          <h4>{{ category.category }}</h4>
          <p-table [value]="category.flags" styleClass="p-datatable-sm">
            <ng-template pTemplate="header">
              <tr>
                <th>Field</th>
                <th>Status</th>
                <th>Message</th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-flag>
              <tr>
                <td>{{ flag.field }}</td>
                <td>
                  <p-tag [severity]="getSeverity(flag.status)" [value]="flag.status"></p-tag>
                </td>
                <td>{{ flag.message }}</td>
                <td>
                  <p-checkbox [(ngModel)]="flag.acknowledged" 
                             (onChange)="acknowledgeFlag(flag, $event)" 
                             [binary]="true" 
                             label="Acknowledge"></p-checkbox>
                  <p-checkbox [(ngModel)]="flag.overridden" 
                             (onChange)="overrideFlag(flag, $event)" 
                             [binary]="true" 
                             label="Override"></p-checkbox>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
      
      <!-- Green Flags Section -->
      <div *ngIf="greenFlags.length > 0">
        <h3>Green Flags</h3>
        <div *ngFor="let category of getFlagsByCategoryForDisplay(greenFlags)">
          <h4>{{ category.category }}</h4>
          <p-table [value]="category.flags" styleClass="p-datatable-sm">
            <ng-template pTemplate="header">
              <tr>
                <th>Field</th>
                <th>Status</th>
                <th>Message</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-flag>
              <tr>
                <td>{{ flag.field }}</td>
                <td>
                  <p-tag [severity]="getSeverity(flag.status)" [value]="flag.status"></p-tag>
                </td>
                <td>{{ flag.message }}</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
      
      <!-- Only show "No flags" message if both red and green flags are empty -->
      <div *ngIf="redFlags.length === 0 && greenFlags.length === 0">
        <p>No flags to display.</p>
      </div>
    </p-card>
  </div>
</div>